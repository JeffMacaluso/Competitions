---
title: "Lake & Property Visualizatoin"
output:
  html_notebook: default
  html_document: default
---

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(readr)
options(dplyr.width = Inf)
```

```{r, message=FALSE, warning=FALSE}
df <- read_csv("~/Kaggle/Dive Into Water/Github Upload/PropertiesPerLake.csv", na = "#N/A")

df <- filter(df, AvgPhosphorus <= 0.3)
```

# Data Description:

This dataset contains information about the counts and proportion of property types (bucketed into residential, agricultural, commercial, industrial, and public) within a 10km distance of a lake by year.  Additionally, it contains a few measures of water quality:

- AvgSeasonalLakeGrade (0 - 4, 4 being best): An annual rating given to a lake.  Compiled from readings taken from May through September.
- AvgSecchiDepth: The average annual depth (in inches) from readings taken with a Secchi disk throughout the year.  Higher quantities indicate water clarity.
- AvgPhosphorus: The average phosphorus content (in parts per million) taken from readings throughout the year.  Quantities below 0.01 indicate a lack of resources for plant live, and quantities above 0.1 are considered eutrophic - when the lake is too rich in nutrients, and results in the decomposition from a dense plant population killing animal life through depriving it of oxygen

These health measures are calculated averages of readings across the year.  Outliers and lakes/year combinations with a low number of readings were removed to prevent them from skewing the results.

Here is a preview of the data along with the summary statistics:

```{r}
head(df)
summary(df)
```

This function was taken from the [Cookbook for R](http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/) to imitate a facet grid with multiple plots.

```{r}
# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
    library(grid)
    
    # Make a list from the ... arguments and plotlist
    plots <- c(list(...), plotlist)
    
    numPlots = length(plots)
    
    # If layout is NULL, then use 'cols' to determine layout
    if (is.null(layout)) {
        # Make the panel
        # ncol: Number of columns of plots
        # nrow: Number of rows needed, calculated from # of cols
        layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                         ncol = cols, nrow = ceiling(numPlots/cols))
    }
    
    if (numPlots==1) {
        print(plots[[1]])
        
    } else {
        # Set up the page
        grid.newpage()
        pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
        
        # Make each plot, in the correct location
        for (i in 1:numPlots) {
            # Get the i,j matrix positions of the regions that contain this subplot
            matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
            
            print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                            layout.pos.col = matchidx$col))
        }
    }
}
```


Y = Avg phosphorus

X = Proportion of proprerty type

Color = Average Lake Grade

Size = Density

Green horizontal line = Eutrophic.  Anything over this is considered bad for lake health.

```{r, fig.height=9, fig.width=12, message=FALSE, warning=FALSE}
resPhos <- ggplot(df, aes(ResidentialProportion, AvgPhosphorus)) + geom_point(aes(color = AvgSeasonalLakeGrade, size = TotalCount), alpha = 0.5) + scale_colour_gradient(low = "red", high = "forestgreen") + geom_smooth(method = 'loess', color = 'dodgerblue') + xlim(0, 1) + ylim (0, 0.3) + labs(title = "Average Phosphorous by Proportion of Residential Properties near Lake", x = "% of Residential Properties", y = "Average Annual Phosphorous", color = 'Seasonal Grade', size = '# Properties') + geom_hline(yintercept = 0.1, color = 'forestgreen')

resPhos
```

```{r, message=FALSE, warning=FALSE}
# Agricultural
agrPhos <- ggplot(df, aes(AgriculturalProportion, AvgPhosphorus)) +
             geom_point(aes(color = AvgSeasonalLakeGrade, size = TotalCount), alpha = .5) +
             scale_colour_gradient(low = "red", high = "forestgreen") +
             geom_smooth(method = 'loess', color = 'dodgerblue') +
             xlim(0, 1) + ylim(0, 0.3) + geom_hline(yintercept = 0.1, color = 'forestgreen') + 
             theme(legend.position = "none")  # Legend disabled to save space on slide containing facet grid

# Commercial
comPhos <- ggplot(df, aes(CommercialProportion, AvgPhosphorus)) +
             geom_point(aes(color = AvgSeasonalLakeGrade, size = TotalCount), alpha = .5) +
             scale_colour_gradient(low = "red", high = "forestgreen") +
             geom_smooth(method = 'loess', color = 'dodgerblue') +
             xlim(0, 1) + ylim(0, 0.3) + geom_hline(yintercept = 0.1, color = 'forestgreen') + 
             theme(legend.position = "none")

# Industrial
indPhos <- ggplot(df, aes(IndustrialProportion, AvgPhosphorus)) +
             geom_point(aes(color = AvgSeasonalLakeGrade, size = TotalCount), alpha = .5) +
             scale_colour_gradient(low = "red", high = "forestgreen") +
             geom_smooth(method = 'lm', color = 'dodgerblue') +
             xlim(0, 1) + ylim(0, 0.3) + geom_hline(yintercept = 0.1, color = 'forestgreen') + 
             theme(legend.position = "none")

# Public
pubPhos <- ggplot(df, aes(PublicProportion, AvgPhosphorus)) +
             geom_point(aes(color = AvgSeasonalLakeGrade, size = TotalCount), alpha = .5) +
             scale_colour_gradient(low = "red", high = "forestgreen") +
             geom_smooth(method = 'loess', color = 'dodgerblue') +
             xlim(0, 1) + ylim(0, 0.3) + geom_hline(yintercept = 0.1, color = 'forestgreen') + 
             theme(legend.position = "none")


```



```{r, fig.height=9, fig.width=12, message=FALSE, warning=FALSE}
# Phosphorus


multiplot(agrPhos + labs(title = "Agricultural", x = element_blank()), comPhos + labs(title = "Commercial", x = element_blank()), indPhos + labs(title = "Industrial", x = element_blank(), y = element_blank()), pubPhos + labs(title = "Public", x = element_blank(), y = element_blank()), cols = 2)

resPhos + facet_wrap(~ Year) + labs(title = "Average Phosphorus by Residential Property Proportion and Year", x = "% of Residential Properties", y = "Average Annual Phosphorous", color = 'Seasonal Grade', size = '# Properties') + theme(legend.position = "none")

agrPhos + facet_wrap(~ Year) + labs(title = "Average Phosphorus by Agricultural Property Proportion and Year", x = "% of Agricultural Properties", y = "Average Annual Phosphorous", color = 'Seasonal Grade', size = '# Properties')

# Nothing of note in commercial

pubPhos + facet_wrap(~ Year) + labs(title = "Average Phosphorus by Public Property Proportion and Year", x = "% of Public Properties", y = "Average Annual Phosphorous", color = 'Seasonal Grade', size = '# Properties')  + xlim(0, .35)
```

